{% extends "front/base.html" %}

{% block content %}
<body>
<p><a href="/taxons">Taxa list</a> | <a href=" ">Add taxon</a> </p>

{% with test=user.groups.all|length %}
{% if test > 0 %}

<h1>Add taxon</h1>
  <form action="" method="post" id="parent-form", data-rankOfTaxonToBeAdded-url="/load_rankOfTaxonToBeAdded" data_parentTaxon-url="/load_parentTaxon" novalidate>
    {% csrf_token %}
    <table>
    {{ form.as_table }}
    </table>
    <input type="submit" value="Submit">
  </form>


<script>
  $("#id_kingdom_name").change(function (e) {
    e.preventDefault();
    var url = $( '#parent-form' ).attr( 'data-rankOfTaxonToBeAdded-url' );
    var parentId = $(this).val();

    $.ajax({
      url: url,
      data: {
        'id': parentId
      },
      success: function(data) {
          $('#id_taxonnomic_types').html(data);
      },
      error: function(data) {
          alert('errors');
      }
    });
  });
</script>

<script>
  $("#id_taxonnomic_types").change(function (e) {
    e.preventDefault();

    var url = $( '#parent-form' ).attr( 'data_parentTaxon-url' );
    var rankId = $(this).val();
    var kingdomId = $('#id_kingdom_name').val();
    $.ajax({
      url: url,
      data: {
        'id': rankId,
        'kingdomId': kingdomId
      },
      success: function(data) {
        // alert(data);
        $('#id_rank_name').html(data).select2();
      },
      error: function(data) {
          alert('errors');
      }
    });
  });
</script>
<script>
  $(document).ready(function(){
    $("#id_taxonnomic_types").select2({
      width: 'auto'
    });
  });
</script>

{% else %}

<head>
  <meta http-equiv="Refresh" content="0;url=/">
</head>

{% endif %}
{% endwith %}

</body>
{% endblock %}
